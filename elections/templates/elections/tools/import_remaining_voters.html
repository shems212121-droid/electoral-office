{% extends "elections/base.html" %}
{% load static %}

{% block title %}Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙ†{% endblock %}

{% block extra_css %}
<style>
    .import-tool-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .stat-item {
        text-align: center;
        padding: 15px;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .progress-ring {
        width: 150px;
        height: 150px;
        margin: 0 auto;
    }

    .round-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .round-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .round-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .round-badge {
        font-size: 2rem;
        font-weight: bold;
    }

    .round-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
    }

    .detail-item {
        text-align: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .detail-label {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 5px;
    }

    .detail-value {
        font-size: 1.1rem;
        font-weight: bold;
        color: #495057;
    }

    .start-btn {
        width: 100%;
        padding: 15px;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
    }

    .start-btn:hover:not(:disabled) {
        transform: scale(1.02);
    }

    .start-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .log-container {
        background: #1e1e1e;
        color: #00ff00;
        padding: 20px;
        border-radius: 10px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        max-height: 400px;
        overflow-y: auto;
        margin-top: 20px;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .log-line {
        margin-bottom: 5px;
        padding: 5px;
        border-left: 3px solid transparent;
    }

    .log-line.success {
        border-left-color: #00ff00;
    }

    .log-line.error {
        border-left-color: #ff0000;
        color: #ff6b6b;
    }

    .log-line.info {
        border-left-color: #00bfff;
        color: #00bfff;
    }

    .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse 2s infinite;
    }

    .status-indicator.running {
        background: #00ff00;
    }

    .status-indicator.stopped {
        background: #ff0000;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="import-tool-container">
    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
    <div class="text-center mb-4">
        <h1 class="display-4 fw-bold"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            ğŸš€ Ø£Ø¯Ø§Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠÙ†
        </h1>
        <p class="text-muted">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ~1,000,000 Ù†Ø§Ø®Ø¨ Ø¹Ø¨Ø± 3 Ø¬ÙˆÙ„Ø§Øª Ù…Ù†Ø¸Ù…Ø©</p>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="stats-card">
        <div class="row">
            <div class="col-md-3 stat-item">
                <div class="stat-value">{{ current_count|floatformat:0|default:"0" }}</div>
                <div class="stat-label">Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø­Ø§Ù„ÙŠØ§Ù‹</div>
            </div>
            <div class="col-md-3 stat-item">
                <div class="stat-value">{{ expected_count|floatformat:0|default:"0" }}</div>
                <div class="stat-label">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
            </div>
            <div class="col-md-3 stat-item">
                <div class="stat-value">{{ remaining|floatformat:0|default:"0" }}</div>
                <div class="stat-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
            </div>
            <div class="col-md-3 stat-item">
                <div class="stat-value">{{ percentage|floatformat:1 }}%</div>
                <div class="stat-label">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
            </div>
        </div>
        <div class="progress mt-3" style="height: 30px; background: rgba(255,255,255,0.2);">
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                style="width: {{ percentage }}%; background: rgba(255,255,255,0.9); color: #667eea; font-weight: bold; font-size: 1.1rem;"
                aria-valuenow="{{ percentage }}" aria-valuemin="0" aria-valuemax="100">
                {{ percentage|floatformat:1 }}%
            </div>
        </div>
    </div>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ -->
    <div class="round-card" id="status-card" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">
                Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
                <span class="status-indicator running" id="status-indicator"></span>
            </h4>
            <button class="btn btn-danger btn-sm" onclick="stopImport()" id="stop-btn">
                Ø¥ÙŠÙ‚Ø§Ù
            </button>
        </div>

        <div class="row text-center mb-3">
            <div class="col-md-4">
                <div class="detail-item">
                    <div class="detail-label">Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                    <div class="detail-value" id="current-round">-</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="detail-item">
                    <div class="detail-label">Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                    <div class="detail-value" id="current-batch">-</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="detail-item">
                    <div class="detail-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</div>
                    <div class="detail-value" id="total-voters">{{ current_count|floatformat:0 }}</div>
                </div>
            </div>
        </div>

        <div class="log-container" id="log-container">
            <div class="log-line info">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...</div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø§Øª -->
    <div class="row">
        {% for round in rounds %}
        <div class="col-md-4 mb-3">
            <div class="round-card">
                <div class="round-header">
                    <span class="round-badge text-{{ round.color }}">{{ round.number }}</span>
                    <h5 class="mb-0">{{ round.name }}</h5>
                </div>

                <div class="round-details">
                    <div class="detail-item">
                        <div class="detail-label">Ø§Ù„Ø¯ÙØ¹Ø§Øª</div>
                        <div class="detail-value">{{ round.batches }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Ø§Ù„Ù†Ø§Ø®Ø¨ÙˆÙ†</div>
                        <div class="detail-value">~{{ round.expected_voters|floatformat:0 }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Ø§Ù„Ù…Ø¯Ø©</div>
                        <div class="detail-value">{{ round.duration }}</div>
                    </div>
                </div>

                <button class="start-btn bg-{{ round.color }} text-white"
                    onclick="startRound({{ round.number }}, {{ round.start }}, {{ round.end }})"
                    id="start-btn-{{ round.number }}">
                    <span id="btn-text-{{ round.number }}">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© {{ round.number }}</span>
                    <span id="btn-spinner-{{ round.number }}" class="spinner" style="display: none;"></span>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ (Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„) -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-dark shadow-sm bg-light">
                <div class="card-body text-center">
                    <h5 class="card-title text-dark fw-bold">ğŸš€ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„ (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)</h5>
                    <p class="text-muted">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (1.8 Ù…Ù„ÙŠÙˆÙ† Ù†Ø§Ø®Ø¨) Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯.
                        Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.</p>
                    <button id="btn-final" class="btn btn-dark btn-lg px-5" onclick="startFinalImport()">
                        <i class="fas fa-database me-2"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
    <div class="round-card mt-4">
        <h5 class="mb-3">ğŸ“‹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</h5>
        <ol>
            <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©" Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</li>
            <li>Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø£Ø¹Ù„Ø§Ù‡</li>
            <li>Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªÙƒØªÙ…Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø© Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©</li>
            <li>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥ÙŠÙ‚Ø§Ù"</li>
            <li>Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø°ÙƒÙŠØ© - ØªØªØ®Ø·Ù‰ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹</li>
        </ol>

        <div class="alert alert-warning mt-3">
            <strong>âš ï¸ Ù‡Ø§Ù…:</strong> Ù„Ø§ ØªØºÙ„Ù‚ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯. Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆÙ„ÙƒÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
            ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙ‚Ø·.
        </div>
    </div>
</div>

<script>
    let statusInterval = null;
    let isImportRunning = false;

    // Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯
    async function startRound(roundNum, startBatch, endBatch) {
        if (isImportRunning) {
            alert('Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„!');
            return;
        }

        if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© ${roundNum}ØŸ\nØ§Ù„Ø¯ÙØ¹Ø§Øª: ${startBatch}-${endBatch - 1}\nØ§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: 15-40 Ø¯Ù‚ÙŠÙ‚Ø©`)) {
            return;
        }

        // ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        disableAllButtons(true);

        // Ø¹Ø±Ø¶ Spinner
        document.getElementById(`btn-text-${roundNum}`).style.display = 'none';
        document.getElementById(`btn-spinner-${roundNum}`).style.display = 'inline-block';

        try {
            const response = await fetch('{% url "import_start_round" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    round: roundNum,
                    start: startBatch,
                    end: endBatch
                })
            });

            const data = await response.json();

            if (data.success) {
                isImportRunning = true;
                document.getElementById('status-card').style.display = 'block';
                document.getElementById('status-indicator').className = 'status-indicator running';

                // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­Ø§Ù„Ø©
                startStatusPolling();
            } else {
                alert('Ø®Ø·Ø£: ' + data.message);
                disableAllButtons(false);
            }
        } catch (error) {
            alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            disableAllButtons(false);
        }

        // Ø¥Ø®ÙØ§Ø¡ Spinner
        document.getElementById(`btn-text-${roundNum}`).style.display = 'inline';
        document.getElementById(`btn-spinner-${roundNum}`).style.display = 'none';
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
    function startStatusPolling() {
        if (statusInterval) {
            clearInterval(statusInterval);
        }
        statusInterval = setInterval(updateStatus, 2000);  // ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ†
        updateStatus();  // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
    async function startFinalImport() {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„ØŸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¶Ù…ÙˆÙ†Ø© ÙˆÙ„ÙƒÙ† Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª.')) {
            return;
        }

        const btn = document.getElementById('btn-final');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø¯Ø¡...';
        btn.disabled = true;

        try {
            const response = await fetch('/tool/import-remaining/final/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({})
            });

            const data = await response.json();

            if (data.success) {
                // Ù†ØªØ±Ùƒ Ø§Ù„Ø§Ø²Ø±Ø§Ø± Ù…Ø¹Ø·Ù„Ø© ÙˆÙ†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                alert('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø³Ø¬Ù„ Ø£Ø¯Ù†Ø§Ù‡.');
            } else {
                alert('Ø®Ø·Ø£: ' + data.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    async function updateStatus() {
        try {
            const response = await fetch('{% url "import_get_status" %}');
            const data = await response.json();

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
            document.getElementById('current-round').textContent = data.current_round || '-';
            document.getElementById('current-batch').textContent = data.current_batch || '-';
            document.getElementById('total-voters').textContent = data.current_voter_count?.toLocaleString('ar-EG') || '0';

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = '';

            (data.log || []).forEach(line => {
                const div = document.createElement('div');
                div.className = 'log-line';

                if (line.includes('âœ…')) div.classList.add('success');
                else if (line.includes('âŒ')) div.classList.add('error');
                else div.classList.add('info');

                div.textContent = line;
                logContainer.appendChild(div);
            });

            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
            logContainer.scrollTop = logContainer.scrollHeight;

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            if (!data.running && isImportRunning) {
                isImportRunning = false;
                document.getElementById('status-indicator').className = 'status-indicator stopped';
                disableAllButtons(false);
                clearInterval(statusInterval);

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                location.reload();
            }

        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:', error);
        }
    }

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
    async function stopImport() {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙŠÙ‚Ø§Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ØŸ')) {
            return;
        }

        try {
            const response = await fetch('{% url "import_stop" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            });

            const data = await response.json();
            alert(data.message);

        } catch (error) {
            alert('Ø®Ø·Ø£: ' + error.message);
        }
    }

    // ØªØ¹Ø·ÙŠÙ„/ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    function disableAllButtons(disable) {
        for (let i = 1; i <= 3; i++) {
            const btn = document.getElementById(`start-btn-${i}`);
            if (btn) {
                btn.disabled = disable;
            }
        }

        const stopBtn = document.getElementById('stop-btn');
        if (stopBtn) {
            stopBtn.disabled = !disable;
        }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', () => {
        updateStatus();

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¹Ù…Ù„ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
        setTimeout(() => {
            if (isImportRunning) {
                document.getElementById('status-card').style.display = 'block';
                startStatusPolling();
            }
        }, 500);
    });
</script>
{% endblock %}