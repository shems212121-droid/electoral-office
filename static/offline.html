<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨ÙŠ - Standalone</title>

    <!-- PWA -->
    <meta name="theme-color" content="#FFD700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #1B5E20;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .status-bar {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .online-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            display: inline-block;
            margin-left: 10px;
        }

        .offline .online-indicator {
            background: #F44336;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: #1B5E20;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }

        button:hover {
            background: #0D3310;
        }

        .voter-list {
            margin-top: 30px;
        }

        .voter-card {
            background: #f9f9f9;
            border-right: 4px solid #FFD700;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .badge-success {
            background: #4CAF50;
            color: white;
        }

        .badge-warning {
            background: #FF9800;
            color: white;
        }

        .badge-danger {
            background: #F44336;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-danger {
            background: #F44336;
        }

        .btn-primary {
            background: #2196F3;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification-success {
            background: #4CAF50;
        }

        .notification-error {
            background: #F44336;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .buttons-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ—³ï¸ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨ÙŠ - Ù†Ø³Ø®Ø© Offline</h1>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div>
                <span class="online-indicator"></span>
                <span id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
            </div>
            <div class="buttons-row">
                <button onclick="exportDB()">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
                <button onclick="document.getElementById('importFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                <button onclick="sync()">ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø©</button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display:none">
        </div>

        <!-- Statistics -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</div>
                <div class="stat-number" id="votersCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†</div>
                <div class="stat-number" id="candidatesCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ù…Ø±ØªÙƒØ²Ø§Øª</div>
                <div class="stat-number" id="anchorsCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ù…Ø¹Ø±ÙÙŠÙ†</div>
                <div class="stat-number" id="introducersCount">0</div>
            </div>
        </div>

        <!-- Add Voter Form -->
        <h2>â• Ø¥Ø¶Ø§ÙØ© Ù†Ø§Ø®Ø¨</h2>
        <form id="voterForm" onsubmit="addVoter(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ *</label>
                    <input type="text" name="voter_number" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                    <input type="text" name="full_name" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <select name="classification">
                        <option value="">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
                        <option value="supporter">Ù…Ø¤ÙŠØ¯</option>
                        <option value="neutral">Ù…Ø­Ø§ÙŠØ¯</option>
                        <option value="opponent">Ù…Ø¹Ø§Ø±Ø¶</option>
                    </select>
                </div>
            </div>
            <button type="submit">Ø­ÙØ¸ Ø§Ù„Ù†Ø§Ø®Ø¨</button>
        </form>

        <!-- Voters List -->
        <h2 style="margin-top: 40px;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø§Ø®Ø¨ÙŠÙ†</h2>
        <div id="votersList" class="voter-list"></div>
    </div>

    <!-- Include Local Database Scripts -->
    <script src="localdb.js"></script>
    <script src="sync.js"></script>

    <script>
        // Update online status
        function updateOnlineStatus() {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');

            if (navigator.onLine) {
                statusBar.classList.remove('offline');
                statusText.textContent = 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
            } else {
                statusBar.classList.add('offline');
                statusText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ - ÙˆØ¶Ø¹ Offline';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        window.addEventListener('load', updateOnlineStatus);

        // Show notification
        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Add voter
        async function addVoter(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            try {
                await localDB.add('voters', data);
                showNotification('success', 'âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø§Ø®Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                event.target.reset();
                await loadVoters();
                await updateStats();
            } catch (error) {
                showNotification('error', 'âŒ ÙØ´Ù„Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message);
            }
        }

        // Load voters
        async function loadVoters() {
            const votersList = document.getElementById('votersList');
            const voters = await localDB.getAll('voters');

            if (voters.length === 0) {
                votersList.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                return;
            }

            votersList.innerHTML = voters.map((voter, index) => `
                <div class="voter-card">
                    <div>
                        <strong>${voter.full_name}</strong><br>
                        <small>Ø±Ù‚Ù…: ${voter.voter_number}</small>
                    </div>
                    <div>
                        ${voter.classification ? `<span class="badge badge-${getClassColor(voter.classification)}">${getClassLabel(voter.classification)}</span>` : ''}
                        ${voter.phone ? `<small>${voter.phone}</small>` : ''}
                    </div>
                    <div>
                        <button class="btn-small btn-danger" onclick="deleteVoter(${voter.id})">Ø­Ø°Ù</button>
                    </div>
                </div>
            `).join('');
        }

        // Delete voter
        async function deleteVoter(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) return;

            try {
                await localDB.delete('voters', id);
                showNotification('success', 'âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù');
                await loadVoters();
                await updateStats();
            } catch (error) {
                showNotification('error', 'âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù');
            }
        }

        // Update stats
        async function updateStats() {
            const stats = await localDB.getStats();
            document.getElementById('votersCount').textContent = stats.voters || 0;
            document.getElementById('candidatesCount').textContent = stats.candidates || 0;
            document.getElementById('anchorsCount').textContent = stats.anchors || 0;
            document.getElementById('introducersCount').textContent = stats.introducers || 0;
        }

        // Export database
        async function exportDB() {
            try {
                await syncManager.exportDatabase();
                showNotification('success', 'âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                showNotification('error', 'âŒ ÙØ´Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }

        // Import database
        document.getElementById('importFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                await syncManager.importDatabase(file);
                showNotification('success', 'âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
                await loadVoters();
                await updateStats();
            } catch (error) {
                showNotification('error', 'âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
            }
        });

        // Sync
        async function sync() {
            if (!navigator.onLine) {
                showNotification('error', 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                return;
            }

            try {
                const result = await syncManager.fullSync();
                showNotification('success', 'âœ… ' + result.message);
            } catch (error) {
                showNotification('error', 'âŒ ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
            }
        }

        // Helper functions
        function getClassColor(classification) {
            return { 'supporter': 'success', 'neutral': 'warning', 'opponent': 'danger' }[classification] || 'secondary';
        }

        function getClassLabel(classification) {
            return { 'supporter': 'Ù…Ø¤ÙŠØ¯', 'neutral': 'Ù…Ø­Ø§ÙŠØ¯', 'opponent': 'Ù…Ø¹Ø§Ø±Ø¶' }[classification] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        // Initialize
        window.addEventListener('localdb-ready', async () => {
            showNotification('success', 'âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©');
            await loadVoters();
            await updateStats();
        });
    </script>
</body>

</html>