#!/bin/bash
# ุณูุฑูุจุช ุณุฑูุน ูุงุณุชูุฑุงุฏ ุงููุงุฎุจูู ุงููุชุจููู ุนูู Railway
# ููุงุณุชุฎุฏุงู ุนูู Railway Terminal ูุจุงุดุฑุฉ

echo "======================================================================"
echo "๐ ุงุณุชูุฑุงุฏ ุงููุงุฎุจูู ุงููุชุจููู - Railway"
echo "======================================================================"
echo ""

# ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
echo "๐ ูุญุต ุงููุถุน ุงูุญุงูู..."
python manage.py shell -c "from elections.models import Voter; print(f'ุงููุงุฎุจูู ุงูุญุงูููู: {Voter.objects.count():,}')"
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ ุงููููุงุช
if [ ! -d "voter_batches" ]; then
    echo "โ๏ธ  ูุฌูุฏ voter_batches ุบูุฑ ููุฌูุฏ!"
    echo "ูุฌุจ ุฑูุน ุงููููุงุช ุฃููุงู ุนุจุฑ:"
    echo "  railway up voter_batches:/app/voter_batches"
    exit 1
fi

echo "โ ุงููุฌูุฏ ููุฌูุฏ"
echo ""

# ุนุฏ ุงููููุงุช
batch_count=$(ls voter_batches/voters_batch_*.json 2>/dev/null | wc -l)
echo "๐ฆ ุนุฏุฏ ูููุงุช ุงูุฏูุนุงุช: $batch_count"

if [ $batch_count -eq 0 ]; then
    echo "โ ูุง ุชูุฌุฏ ูููุงุช ุฏูุนุงุช!"
    exit 1
fi

echo ""
echo "======================================================================"
echo "๐ต ุงูุฌููุฉ 1 ูู 3: ุงูุฏูุนุงุช 18-27"
echo "======================================================================"
echo "โฑ๏ธ  ุงููุฏุฉ ุงููุชููุนุฉ: 30-40 ุฏูููุฉ"
echo "๐ ุงููุงุฎุจูู ุงููุชููุนูู: ~500,000"
echo ""
read -p "ูู ุชุฑูุฏ ุจุฏุก ุงูุฌููุฉ 1ุ (y/n): " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "๐ ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ..."
    IMPORT_START_BATCH=18 IMPORT_END_BATCH=28 python import_voters_batches.py
    
    echo ""
    echo "โ ุงูุฌููุฉ 1 ุงูุชููุช!"
    echo "๐ ูุญุต ุงูุนุฏุฏ ุงูุญุงูู..."
    python manage.py shell -c "from elections.models import Voter; print(f'ุงูุฅุฌูุงูู ุงูุขู: {Voter.objects.count():,}')"
    echo ""
else
    echo "โ ุชู ุงูุฅูุบุงุก"
    exit 0
fi

echo ""
echo "======================================================================"
echo "๐ข ุงูุฌููุฉ 2 ูู 3: ุงูุฏูุนุงุช 28-33"
echo "======================================================================"
echo "โฑ๏ธ  ุงููุฏุฉ ุงููุชููุนุฉ: 20-30 ุฏูููุฉ"
echo "๐ ุงููุงุฎุจูู ุงููุชููุนูู: ~300,000"
echo ""
read -p "ูู ุชุฑูุฏ ุจุฏุก ุงูุฌููุฉ 2ุ (y/n): " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "๐ ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ..."
    IMPORT_START_BATCH=28 IMPORT_END_BATCH=34 python import_voters_batches.py
    
    echo ""
    echo "โ ุงูุฌููุฉ 2 ุงูุชููุช!"
    echo "๐ ูุญุต ุงูุนุฏุฏ ุงูุญุงูู..."
    python manage.py shell -c "from elections.models import Voter; print(f'ุงูุฅุฌูุงูู ุงูุขู: {Voter.objects.count():,}')"
    echo ""
else
    echo "โ ุชู ุงูุฅูุบุงุก"
    exit 0
fi

echo ""
echo "======================================================================"
echo "๐ก ุงูุฌููุฉ 3 ูู 3: ุงูุฏูุนุงุช 34-38"
echo "======================================================================"
echo "โฑ๏ธ  ุงููุฏุฉ ุงููุชููุนุฉ: 15-25 ุฏูููุฉ"
echo "๐ ุงููุงุฎุจูู ุงููุชููุนูู: ~200,000"
echo ""
read -p "ูู ุชุฑูุฏ ุจุฏุก ุงูุฌููุฉ 3 ุงูููุงุฆูุฉุ (y/n): " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "๐ ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ..."
    IMPORT_START_BATCH=34 IMPORT_END_BATCH=39 python import_voters_batches.py
    
    echo ""
    echo "โ ุงูุฌููุฉ 3 ุงูุชููุช!"
    echo ""
else
    echo "โ ุชู ุงูุฅูุบุงุก"
    exit 0
fi

echo ""
echo "======================================================================"
echo "๐ ุงูุชููุช ุฌููุน ุงูุฌููุงุช!"
echo "======================================================================"
echo ""

echo "โ ุงูุชุญูู ุงูููุงุฆู..."
python manage.py shell << EOF
from elections.models import Voter

total = Voter.objects.count()
expected = 1868933
percentage = (total / expected) * 100

print(f"""
๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
   - ุงูููุฌูุฏ: {total:,}
   - ุงููุชููุน: {expected:,}
   - ุงููุณุจุฉ: {percentage:.2f}%
""")

if total == expected:
    print("โ ุฌููุน ุงููุงุฎุจูู ูุณุชูุฑุฏูู ุจูุฌุงุญ! ๐")
elif total > expected * 0.99:
    print("โ๏ธ  ูุณุชูุฑุฏ ุชูุฑูุจุงู (99%+)")
else:
    missing = expected - total
    print(f"โ ูุงูุต {missing:,} ูุงุฎุจ")
    print("๐ก ูุฏ ุชุญุชุงุฌ ูุฅุนุงุฏุฉ ุชุดุบูู ุจุนุถ ุงูุฌููุงุช")
EOF

echo ""
echo "======================================================================"
echo "โ ุงูุชูู ุงูุงุณุชูุฑุงุฏ"
echo "======================================================================"
echo ""
echo "๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "   1. ุงูุชุญ: https://web-production-42c39.up.railway.app/"
echo "   2. ุณุฌู ุฏุฎูู: admin / admin123"
echo "   3. ุชุญูู ูู ููุญุฉ ุงูุชุญูู"
echo "   4. ุฌุฑุจ ุงูุจุญุซ ุนู ูุงุฎุจ"
echo ""
echo "๐ ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ!"
